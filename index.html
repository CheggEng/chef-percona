<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>chef-percona by phlipper</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>chef-percona</h1>
        <p>Chef cookbook for Percona MySQL components</p>
        <p class="view"><a href="https://github.com/phlipper/chef-percona">View the Project on GitHub <small>phlipper/chef-percona</small></a></p>
        <ul>
          <li><a href="https://github.com/phlipper/chef-percona/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/phlipper/chef-percona/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/phlipper/chef-percona">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h2>
<a id="flair" class="anchor" href="#flair" aria-hidden="true"><span class="octicon octicon-link"></span></a>Flair</h2>

<p><a href="https://supermarket.chef.io/cookbooks/percona"><img src="https://img.shields.io/cookbook/v/percona.svg" alt="Cookbook Version"></a>
<a href="http://phlipper.mit-license.org/2012-2015/license.html"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="License"></a>
<a href="https://travis-ci.org/phlipper/chef-percona"><img src="http://img.shields.io/travis-ci/phlipper/chef-percona.png" alt="Build Status"></a>
<a href="https://codeclimate.com/github/phlipper/chef-percona"><img src="https://codeclimate.com/github/phlipper/chef-percona.png" alt="Code Climate"></a>
<a href="https://gitter.im/phlipper/chef-percona"><img src="https://img.shields.io/badge/Gitter%2Eim-Join_Chat_%E2%86%92-yellow.svg" alt="Gitter"></a>
<img src="https://img.shields.io/badge/It_Works-On_My_Machine%E2%84%A2-orange.svg" alt="It Works On My Machineâ„¢">
<a href="https://gratipay.com/phlipper/"><img src="http://img.shields.io/gratipay/phlipper.png" alt="Tip"></a>
<a href="http://coderwall.com/phlipper"><img src="http://api.coderwall.com/phlipper/endorsecount.png" alt="Endorse"></a></p>

<h2>
<a id="description" class="anchor" href="#description" aria-hidden="true"><span class="octicon octicon-link"></span></a>Description</h2>

<p>Installs the <a href="http://www.percona.com/software/percona-server">Percona
MySQL</a> client and/or
server components. (We are attempting to leverage the official Opscode
MySQL cookbook as much as possible.)</p>

<p>Optionally installs:</p>

<ul>
<li>
<a href="http://www.percona.com/software/percona-xtrabackup/">XtraBackup</a> hot backup software</li>
<li>
<a href="http://www.percona.com/software/percona-toolkit/">Percona Toolkit</a> advanced command-line tools</li>
<li>
<a href="http://www.percona.com/software/percona-xtradb-cluster/">XtraDB
Cluster</a> high
availability and high scalability solution for MySQL.</li>
<li>
<a href="http://www.percona.com/software/percona-monitoring-plugins">Percona Monitoring Plugins</a> various Nagios plugins for monitoring MySQL</li>
</ul>

<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h2>

<h3>
<a id="supported-platforms" class="anchor" href="#supported-platforms" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supported Platforms</h3>

<p>We provide an expanding set of tests against the following 64-bit platforms:</p>

<ul>
<li>Amazon 2014.03</li>
<li>CentOS 6.5</li>
<li>CentOS 7.0</li>
<li>Debian 7.8</li>
<li>Ubuntu 12.04 LTS</li>
<li>Ubuntu 14.04 LTS</li>
</ul>

<p>Although we don't test against all possible platform verions, we expect
the following to be supported. Please submit an issue if this is not the
cause, and we'll make reasonable efforts to improve support:</p>

<ul>
<li>Ubuntu</li>
<li>Debian</li>
<li>Amazon Linux AMI</li>
<li>CentOS</li>
<li>Red Hat</li>
<li>Scientific</li>
<li>Fedora</li>
</ul>

<h3>
<a id="cookbooks" class="anchor" href="#cookbooks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Cookbooks</h3>

<ul>
<li>
<a href="https://supermarket.getchef.com/cookbooks/apt">apt</a> Chef LWRP Cookbook</li>
<li>
<a href="https://supermarket.getchef.com/cookbooks/openssl">openssl</a> Chef Cookbook</li>
<li>
<a href="https://supermarket.getchef.com/cookbooks/yum">yum</a> Chef LWRP Cookbook</li>
<li>
<a href="https://supermarket.getchef.com/cookbooks/yum-epel">yum-epel</a> Chef LWRP Cookbook</li>
</ul>

<h3>
<a id="chef" class="anchor" href="#chef" aria-hidden="true"><span class="octicon octicon-link"></span></a>Chef</h3>

<p>This cookbook requires Chef &gt;= 11.14.2 due to the use of the <code>sensitive</code> attribute for some resources.</p>

<p>We aim to test the most recent releases of Chef. You can view
the <a href="https://github.com/phlipper/chef-percona/blob/master/.travis.yml">currently tested versions</a>.
(Feel free to submit a pull request if they're out of date!)</p>

<h2>
<a id="recipes" class="anchor" href="#recipes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Recipes</h2>

<ul>
<li>
<code>percona</code> - The default no-op recipe.</li>
<li>
<code>percona::package_repo</code> - Sets up the package repository and installs common packages.</li>
<li>
<code>percona::client</code> - Installs the Percona MySQL client libraries.</li>
<li>
<code>percona::server</code> - Installs and configures the Percona MySQL server daemon.</li>
<li>
<code>percona::backup</code> - Installs and configures the Percona XtraBackup hot backup software.</li>
<li>
<code>percona::toolkit</code> - Installs the Percona Toolkit software</li>
<li>
<code>percona::cluster</code> - Installs the Percona XtraDB Cluster server components</li>
<li>
<code>percona::configure_server</code> - Used internally to manage the server configuration.</li>
<li>
<code>percona::replication</code> - Used internally to grant permissions for replication.</li>
<li>
<code>percona::access_grants</code> - Used internally to grant permissions for recipes.</li>
<li>
<code>percona::monitoring</code> - Installs Percona monitoring plugins for Nagios</li>
</ul>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>This cookbook installs the Percona MySQL components if not present, and pulls updates if they are installed on the system.</p>

<h3>
<a id="encrypted-passwords" class="anchor" href="#encrypted-passwords" aria-hidden="true"><span class="octicon octicon-link"></span></a>Encrypted Passwords</h3>

<p>This cookbook requires <a href="http://wiki.opscode.com/display/chef/Encrypted+Data+Bags">Encrypted Data Bags</a>. If you forget to use them or do not use a node attribute to overwrite them empty passwords will be used.</p>

<p>To use encrypted passwords, you must create an encrypted data bag. This cookbook assumes a data bag named <code>passwords</code>, but you can override the name using the <code>node[:percona][:encrypted_data_bag]</code> attribute.  You can also optionally specify a data bag secret file to be loaded for the secret key using the <code>node[:percona][:encrypted_data_bag_secret_file]</code> attribute.</p>

<p>This cookbook expects a <code>mysql</code> item  and a <code>system</code> item. Please refer to the official documentation on how to get this setup. It actually uses a MySQL example so it can be mostly copied. Ensure you cover the data bag items as described below.</p>

<h3>
<a id="skip-passwords" class="anchor" href="#skip-passwords" aria-hidden="true"><span class="octicon octicon-link"></span></a>Skip passwords</h3>

<p>Set the <code>["percona"]["skip_passwords"]</code> attribute to skip setting up passwords. Removes the need for the encrypted data bag if using chef-solo. Is useful for setting up development and ci environments where you just want to use the root user with no password. If you are doing this you may want to set <code>[:percona][:server][:debian_username]</code> to be <code>"root"</code> also.</p>

<h3>
<a id="skip-configure" class="anchor" href="#skip-configure" aria-hidden="true"><span class="octicon octicon-link"></span></a>Skip Configure</h3>

<p>Set the <code>['percona']['skip_configure']</code> attribute to skip having the server recipe include the configure_server recipe directly after install. This is mostly useful in a wrapper cookbook sort of context. Once skipped, you can then perform any pre-config actions your wrapper needs to, such as dropping a custom configuration file or init script or cleaning up incorrectly sized innodb logfiles. You can then include configure_server where necessary.</p>

<h4>
<a id="mysql-item" class="anchor" href="#mysql-item" aria-hidden="true"><span class="octicon octicon-link"></span></a>mysql item</h4>

<p>The mysql item should contain entries for root, backup, and replication. If no value is found, the cookbook will fall back to the default non-encrypted password.</p>

<h4>
<a id="system-item" class="anchor" href="#system-item" aria-hidden="true"><span class="octicon octicon-link"></span></a>system item</h4>

<p>The "system" item should contain an entry for the debian system user as specified in the <code>node[:percona][:server][:debian_username]</code> attribute. If no such entry is found, the cookbook will fall back to the default non-encrypted password.</p>

<p>Example: "passwords" data bag - this example assumes that <code>node[:percona][:server][:debian_username] = spud</code></p>

<div class="highlight highlight-javascript"><pre>{
  <span class="pl-s1"><span class="pl-pds">"</span>mysql<span class="pl-pds">"</span></span> <span class="pl-k">:</span>
  {
    <span class="pl-s1"><span class="pl-pds">"</span>root<span class="pl-pds">"</span></span> <span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>trywgFA6R70NO28PNhMpGhEvKBZuxouemnbnAUQsUyo=<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>
    <span class="pl-s1"><span class="pl-pds">"</span>backup<span class="pl-pds">"</span></span> <span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>eqoiudfj098389fjadfkadf=<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>
    <span class="pl-s1"><span class="pl-pds">"</span>replication<span class="pl-pds">"</span></span> <span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>qwo0fj0213fm9020fm2023fjsld=<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>
  },
  <span class="pl-s1"><span class="pl-pds">"</span>system<span class="pl-pds">"</span></span> <span class="pl-k">:</span>
  {
    <span class="pl-s1"><span class="pl-pds">"</span>spud<span class="pl-pds">"</span></span> <span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>dwoifm2340f024jfadgfu243hf2=<span class="pl-cce">\n</span><span class="pl-pds">"</span></span>
  }
}</pre></div>

<p>Above shows the encrypted password in the data bag. Check out the <code>encrypted_data_bag_secret</code> setting in <code>knife.rb</code> to setup your data bag secret during bootstrapping.</p>

<h3>
<a id="replication-over-ssl" class="anchor" href="#replication-over-ssl" aria-hidden="true"><span class="octicon octicon-link"></span></a>Replication over SSL</h3>

<p>To enable SSL based replication, you will need to flip the attribute <code>node[:percona][:server][:replication][:ssl_enabled]</code> to <code>true</code> and add a new data_bag item
to the percona encrypted data_bag (see <code>node[:percona][:encrypted_data_bag]</code> attribute) with the id <code>ssl_replication</code> that contains this data:</p>

<div class="highlight highlight-javascript"><pre>{
  <span class="pl-s1"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>ssl_replication<span class="pl-pds">"</span></span>,
  <span class="pl-s1"><span class="pl-pds">"</span>ca-cert<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>CA_CERTIFICATE_STRING<span class="pl-pds">"</span></span>,
  <span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
    <span class="pl-s1"><span class="pl-pds">"</span>server-cert<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>SERVER_CERTIFICATE_STRING<span class="pl-pds">"</span></span>,
    <span class="pl-s1"><span class="pl-pds">"</span>server-key<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>SERVER_KEY_STRING<span class="pl-pds">"</span></span>
  },
  <span class="pl-s1"><span class="pl-pds">"</span>client<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
    <span class="pl-s1"><span class="pl-pds">"</span>client-cert<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>CLIENT_CERTIFICATE_STRING<span class="pl-pds">"</span></span>,
    <span class="pl-s1"><span class="pl-pds">"</span>client-key<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s1"><span class="pl-pds">"</span>CLIENT_KEY_STRING<span class="pl-pds">"</span></span>
  }
}</pre></div>

<p>All certificates and keys have to be converted to a string (easiest way is to use ruby: <em>/usr/bin/env ruby -e 'p ARGF.read'</em> <strong>filename</strong>) and placed
instead of CA_CERTIFICATE_STRING, SERVER_CERTIFICATE_STRING, SERVER_KEY_STRING, CLIENT_CERTIFICATE_STRING, CLIENT_KEY_STRING.</p>

<h3>
<a id="percona-xtradb-cluster" class="anchor" href="#percona-xtradb-cluster" aria-hidden="true"><span class="octicon octicon-link"></span></a>Percona XtraDB Cluster</h3>

<p>Below is a minimal example setup to bootstrap a Percona XtraDB Cluster. Please see the <a href="http://www.percona.com/doc/percona-xtradb-cluster/5.6/index.html">official documentation</a> for more information. This is not a perfect example. It is just a sample to get you started.</p>

<p>Wrapper recipe recipes/percona.rb:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c"># Setup the Percona XtraDB Cluster</span>
cluster_ips <span class="pl-k">=</span> []
<span class="pl-k">unless</span> <span class="pl-s3">Chef</span>::<span class="pl-s3">Config</span>[<span class="pl-c1">:solo</span>]
  search(<span class="pl-c1">:node</span>, <span class="pl-s1"><span class="pl-pds">'</span>role:percona<span class="pl-pds">'</span></span>).each <span class="pl-k">do </span>|<span class="pl-vo">other_node</span>|
    <span class="pl-k">next</span> <span class="pl-k">if</span> other_node[<span class="pl-s1"><span class="pl-pds">'</span>private_ipaddress<span class="pl-pds">'</span></span>] <span class="pl-k">==</span> node[<span class="pl-s1"><span class="pl-pds">'</span>private_ipaddress<span class="pl-pds">'</span></span>]
    <span class="pl-s3">Chef</span>::<span class="pl-s3">Log</span>.info <span class="pl-s1"><span class="pl-pds">"</span>Found Percona XtraDB cluster peer: <span class="pl-pse">#{</span><span class="pl-s2">other_node[<span class="pl-s1"><span class="pl-pds">'</span>private_ipaddress<span class="pl-pds">'</span></span>]</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span>
    cluster_ips <span class="pl-k">&lt;&lt;</span> other_node[<span class="pl-s1"><span class="pl-pds">'</span>private_ipaddress<span class="pl-pds">'</span></span>]
  <span class="pl-k">end</span>
<span class="pl-k">end</span>

cluster_ips.each <span class="pl-k">do </span>|<span class="pl-vo">ip</span>|
  firewall_rule <span class="pl-s1"><span class="pl-pds">"</span>allow Percona group communication to peer <span class="pl-pse">#{</span><span class="pl-s2">ip</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span> <span class="pl-k">do</span>
    source ip
    port <span class="pl-c1">4567</span>
    action <span class="pl-c1">:allow</span>
  <span class="pl-k">end</span>

  firewall_rule <span class="pl-s1"><span class="pl-pds">"</span>allow Percona state transfer to peer <span class="pl-pse">#{</span><span class="pl-s2">ip</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span> <span class="pl-k">do</span>
    source ip
    port <span class="pl-c1">4444</span>
    action <span class="pl-c1">:allow</span>
  <span class="pl-k">end</span>

  firewall_rule <span class="pl-s1"><span class="pl-pds">"</span>allow Percona incremental state transfer to peer <span class="pl-pse">#{</span><span class="pl-s2">ip</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span> <span class="pl-k">do</span>
    source ip
    port <span class="pl-c1">4568</span>
    action <span class="pl-c1">:allow</span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span>

cluster_address <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>gcomm://<span class="pl-pse">#{</span><span class="pl-s2">cluster_ips.join(<span class="pl-s1"><span class="pl-pds">'</span>,<span class="pl-pds">'</span></span>)</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span>
<span class="pl-s3">Chef</span>::<span class="pl-s3">Log</span>.info <span class="pl-s1"><span class="pl-pds">"</span>Using Percona XtraDB cluster address of: <span class="pl-pse">#{</span><span class="pl-s2">cluster_address</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span>
node.override[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_cluster_address<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> cluster_address
node.override[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_node_name<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> node[<span class="pl-s1"><span class="pl-pds">'</span>hostname<span class="pl-pds">'</span></span>]

include_recipe <span class="pl-s1"><span class="pl-pds">'</span>percona::cluster<span class="pl-pds">'</span></span>
include_recipe <span class="pl-s1"><span class="pl-pds">'</span>percona::backup<span class="pl-pds">'</span></span>
include_recipe <span class="pl-s1"><span class="pl-pds">'</span>percona::toolkit<span class="pl-pds">'</span></span></pre></div>

<p>Example percona role roles/percona.rb:</p>

<div class="highlight highlight-ruby"><pre>name <span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>
description <span class="pl-s1"><span class="pl-pds">"</span>Percona XtraDB Cluster<span class="pl-pds">"</span></span>

run_list <span class="pl-s1"><span class="pl-pds">'</span>recipe[paydici::percona]<span class="pl-pds">'</span></span>

default_attributes(
  <span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span> =&gt; {
    <span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span> =&gt; {
      <span class="pl-s1"><span class="pl-pds">"</span>role<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>
    },

    <span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span> =&gt; {
      <span class="pl-s1"><span class="pl-pds">"</span>package<span class="pl-pds">"</span></span>                     =&gt; <span class="pl-s1"><span class="pl-pds">"</span>percona-xtradb-cluster-56<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>wsrep_cluster_name<span class="pl-pds">"</span></span>          =&gt; <span class="pl-s1"><span class="pl-pds">"</span>percona_cluster_1<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>wsrep_sst_receive_interface<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>eth1<span class="pl-pds">"</span></span> <span class="pl-c"># can be eth0, public, private, etc.</span>
    }
  }
)</pre></div>

<p>Now you need to bring three servers up one at a time with the percona role applied to them. By default the servers will sync up via rsync server state transfer (SST)</p>

<h2>
<a id="attributes" class="anchor" href="#attributes" aria-hidden="true"><span class="octicon octicon-link"></span></a>Attributes</h2>

<div class="highlight highlight-ruby"><pre>default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>version<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>5.6<span class="pl-pds">"</span></span>
version <span class="pl-k">=</span> node[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>version<span class="pl-pds">"</span></span>]

<span class="pl-c"># Always restart percona on configuration changes</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>auto_restart<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>

<span class="pl-k">case</span> node[<span class="pl-s1"><span class="pl-pds">"</span>platform_family<span class="pl-pds">"</span></span>]
<span class="pl-k">when</span> <span class="pl-s1"><span class="pl-pds">"</span>debian<span class="pl-pds">"</span></span>
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>socket<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/var/run/mysqld/mysqld.sock<span class="pl-pds">"</span></span>
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>default_storage_engine<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>InnoDB<span class="pl-pds">"</span></span>
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>includedir<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/etc/mysql/conf.d/<span class="pl-pds">"</span></span>
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>pidfile<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/var/run/mysqld/mysqld.pid<span class="pl-pds">"</span></span>
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>package<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>percona-server-server-<span class="pl-pse">#{</span><span class="pl-s2">version</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span>
<span class="pl-k">when</span> <span class="pl-s1"><span class="pl-pds">"</span>rhel<span class="pl-pds">"</span></span>
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>socket<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/var/lib/mysql/mysql.sock<span class="pl-pds">"</span></span>
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>default_storage_engine<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>innodb<span class="pl-pds">"</span></span>
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>includedir<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>pidfile<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/var/lib/mysql/mysqld.pid<span class="pl-pds">"</span></span>
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>package<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Percona-Server-server-<span class="pl-pse">#{</span><span class="pl-s2">version.tr(<span class="pl-s1"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span>
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>shared_pkg<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Percona-Server-shared-<span class="pl-pse">#{</span><span class="pl-s2">version.tr(<span class="pl-s1"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span>
<span class="pl-k">end</span>

<span class="pl-c"># Cookbook Settings</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>main_config_file<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> value_for_platform_family(
  <span class="pl-s1"><span class="pl-pds">"</span>debian<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>/etc/mysql/my.cnf<span class="pl-pds">"</span></span>,
  <span class="pl-s1"><span class="pl-pds">"</span>rhel<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>/etc/my.cnf<span class="pl-pds">"</span></span>
)
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>keyserver<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>keys.gnupg.net<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>encrypted_data_bag<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>passwords<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>encrypted_data_bag_secret_file<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>use_chef_vault<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>skip_passwords<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>skip_configure<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>

<span class="pl-c"># Start percona server on boot</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>enable<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>

<span class="pl-c"># install vs. upgrade packages</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>package_action<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>install<span class="pl-pds">"</span></span>

<span class="pl-c"># Basic Settings</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>role<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> [<span class="pl-s1"><span class="pl-pds">"</span>standalone<span class="pl-pds">"</span></span>]
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>username<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>mysql<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>datadir<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/var/lib/mysql<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>logdir<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/var/log/mysql<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>tmpdir<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/tmp<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>debian_username<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>debian-sys-maint<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>jemalloc<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>jemalloc_lib<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> value_for_platform_family(
  <span class="pl-s1"><span class="pl-pds">"</span>debian<span class="pl-pds">"</span></span> =&gt; value_for_platform(
    <span class="pl-s1"><span class="pl-pds">"</span>ubuntu<span class="pl-pds">"</span></span> =&gt; {
      <span class="pl-s1"><span class="pl-pds">"</span>trusty<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>/usr/lib/x86_64-linux-gnu/libjemalloc.so.1<span class="pl-pds">"</span></span>,
      <span class="pl-s1"><span class="pl-pds">"</span>precise<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>/usr/lib/libjemalloc.so.1<span class="pl-pds">"</span></span>
    }
  ),
  <span class="pl-s1"><span class="pl-pds">"</span>rhel<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>/usr/lib64/libjemalloc.so.1<span class="pl-pds">"</span></span>
)
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>nice<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-c1">0</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>open_files_limit<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-c1">16_384</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>hostname<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>basedir<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/usr<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-c1">3306</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>language<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/usr/share/mysql/english<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>character_set<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>utf8<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>collation<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>utf8_unicode_ci<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>skip_name_resolve<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>skip_external_locking<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-c1">true</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>net_read_timeout<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-c1">120</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>connect_timeout<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-c1">10</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wait_timeout<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-c1">28_800</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>old_passwords<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-c1">0</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>bind_address<span class="pl-pds">"</span></span>]  <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>127.0.0.1<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>federated<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>

<span class="pl-s1"><span class="pl-pds">%w[</span>debian_password root_password<span class="pl-pds">]</span></span>.each <span class="pl-k">do </span>|<span class="pl-vo">attribute</span>|
  <span class="pl-k">next</span> <span class="pl-k">if</span> attribute?(node[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][attribute])
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][attribute] <span class="pl-k">=</span> secure_password
<span class="pl-k">end</span>

<span class="pl-c"># Fine Tuning</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>key_buffer_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>16M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>max_allowed_packet<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>64M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>thread_stack<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>192K<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>query_alloc_block_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>16K<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>memlock<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>transaction_isolation<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>REPEATABLE-READ<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>tmp_table_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>64M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>max_heap_table_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>64M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>sort_buffer_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>8M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>join_buffer_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>8M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>thread_cache_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">16</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>back_log<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">50</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>max_connections<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">30</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>max_connect_errors<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">9_999_999</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>sql_modes<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> []
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>table_cache<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">8192</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>group_concat_max_len<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">4096</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>expand_fast_index_creation<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>read_rnd_buffer_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">262_144</span>

<span class="pl-c"># Query Cache Configuration</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>query_cache_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>64M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>query_cache_limit<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>2M<span class="pl-pds">"</span></span>

<span class="pl-c"># Logging and Replication</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>sync_binlog<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> (node[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>role<span class="pl-pds">"</span></span>] <span class="pl-k">==</span> <span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span> <span class="pl-k">?</span> <span class="pl-c1">0</span> : <span class="pl-c1">1</span>)
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>slow_query_log<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">1</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>slow_query_logdir<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/var/log/mysql<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>slow_query_log_file<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pse">#{</span><span class="pl-s2">node[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>slow_query_logdir<span class="pl-pds">"</span></span>]</span><span class="pl-pse"><span class="pl-s2">}</span></span>/mysql-slow.log<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>long_query_time<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">2</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server_id<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">1</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>binlog_do_db<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> []
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>expire_logs_days<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">10</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>max_binlog_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>100M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>binlog_cache_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>1M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>binlog_format<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>MIXED<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>log_bin<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>master-bin<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>relay_log<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>slave-relay-bin<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>log_slave_updates<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>log_warnings<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>log_long_format<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>bulk_insert_buffer_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>64M<span class="pl-pds">"</span></span>

<span class="pl-c"># MyISAM Specific</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>myisam_recover_options<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>BACKUP<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>myisam_sort_buffer_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>128M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>myisam_max_sort_file_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>10G<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>myisam_repair_threads<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">1</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>read_buffer_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>8M<span class="pl-pds">"</span></span>

<span class="pl-c"># InnoDB Specific</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>skip_innodb<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_additional_mem_pool_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>32M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_buffer_pool_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>128M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_data_file_path<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>ibdata1:10M:autoextend<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_file_per_table<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">true</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_file_format<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Antelope<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_data_home_dir<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_thread_concurrency<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">16</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_flush_log_at_trx_commit<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">1</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_fast_shutdown<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_log_buffer_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>64M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_log_file_size<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>5M<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_log_files_in_group<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">2</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_max_dirty_pages_pct<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">80</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_flush_method<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>O_DIRECT<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_lock_wait_timeout<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">120</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_import_table_from_xtrabackup<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">0</span>

<span class="pl-c"># Performance Schema</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>performance_schema<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>

<span class="pl-c"># Replication Settings</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>replication<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>read_only<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>replication<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>replication<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>username<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>replication<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>replication<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">3306</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>replication<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>ignore_db<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> []
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>replication<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>ignore_table<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> []
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>replication<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>ssl_enabled<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>replication<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>suppress_1592<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>

<span class="pl-c"># XtraBackup Settings</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>backup<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>configure<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">false</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>backup<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>username<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>backup<span class="pl-pds">"</span></span>
<span class="pl-k">unless</span> attribute?(node[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>backup<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span>])
  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>backup<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> secure_password
<span class="pl-k">end</span>

<span class="pl-c"># XtraDB Cluster Settings</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>package<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> value_for_platform_family(
  <span class="pl-s1"><span class="pl-pds">"</span>debian<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>percona-xtradb-cluster-<span class="pl-pse">#{</span><span class="pl-s2">version.tr(<span class="pl-s1"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span>,
  <span class="pl-s1"><span class="pl-pds">"</span>rhel<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>Percona-XtraDB-Cluster-<span class="pl-pse">#{</span><span class="pl-s2">version.tr(<span class="pl-s1"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span>
)
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>binlog_format<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>ROW<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_provider<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> value_for_platform_family(
  <span class="pl-s1"><span class="pl-pds">"</span>debian<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>/usr/lib/libgalera_smm.so<span class="pl-pds">"</span></span>,
  <span class="pl-s1"><span class="pl-pds">"</span>rhel<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>/usr/lib64/libgalera_smm.so<span class="pl-pds">"</span></span>
)
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_provider_options<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_cluster_address<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_slave_threads<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">2</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_cluster_name<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_sst_method<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>rsync<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_node_name<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_notify_cmd<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_sst_auth<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>

<span class="pl-c"># These both are used to build wsrep_sst_receive_address</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_sst_receive_interface<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">nil</span> <span class="pl-c"># Works like node["percona"]["server"]["bind_to"]</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>wsrep_sst_receive_port<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>4444<span class="pl-pds">"</span></span>

default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_locks_unsafe_for_binlog<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">1</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>innodb_autoinc_lock_mode<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-c1">2</span></pre></div>

<h3>
<a id="clientrb" class="anchor" href="#clientrb" aria-hidden="true"><span class="octicon octicon-link"></span></a>client.rb</h3>

<div class="highlight highlight-ruby"><pre><span class="pl-c"># install vs. upgrade packages</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>client<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>package_action<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>install<span class="pl-pds">"</span></span>

version <span class="pl-k">=</span> value_for_platform_family(
  <span class="pl-s1"><span class="pl-pds">"</span>debian<span class="pl-pds">"</span></span> =&gt; node[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>version<span class="pl-pds">"</span></span>],
  <span class="pl-s1"><span class="pl-pds">"</span>rhel<span class="pl-pds">"</span></span> =&gt; node[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>version<span class="pl-pds">"</span></span>].tr(<span class="pl-s1"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>)
)

<span class="pl-k">case</span> node[<span class="pl-s1"><span class="pl-pds">"</span>platform_family<span class="pl-pds">"</span></span>]
<span class="pl-k">when</span> <span class="pl-s1"><span class="pl-pds">"</span>debian<span class="pl-pds">"</span></span>
  abi_version <span class="pl-k">=</span> <span class="pl-k">case</span> version
                <span class="pl-k">when</span> <span class="pl-s1"><span class="pl-pds">"</span>5.5<span class="pl-pds">"</span></span> <span class="pl-k">then</span> <span class="pl-s1"><span class="pl-pds">"</span>18<span class="pl-pds">"</span></span>
                <span class="pl-k">when</span> <span class="pl-s1"><span class="pl-pds">"</span>5.6<span class="pl-pds">"</span></span> <span class="pl-k">then</span> <span class="pl-s1"><span class="pl-pds">"</span>18.1<span class="pl-pds">"</span></span>
                <span class="pl-k">else</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pds">"</span></span>
                <span class="pl-k">end</span>

  default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>client<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>packages<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">%W[</span></span>
<span class="pl-s1">    libperconaserverclient<span class="pl-pse">#{</span><span class="pl-s2">abi_version</span><span class="pl-pse"><span class="pl-s2">}</span></span>-dev percona-server-client-<span class="pl-pse">#{</span><span class="pl-s2">version</span><span class="pl-pse"><span class="pl-s2">}</span></span></span>
<span class="pl-s1">  <span class="pl-pds">]</span></span>
<span class="pl-k">when</span> <span class="pl-s1"><span class="pl-pds">"</span>rhel<span class="pl-pds">"</span></span>
  <span class="pl-k">if</span> <span class="pl-vo">Array</span>(node[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>role<span class="pl-pds">"</span></span>]).include?(<span class="pl-s1"><span class="pl-pds">"</span>cluster<span class="pl-pds">"</span></span>)
    default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>client<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>packages<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">%W[</span></span>
<span class="pl-s1">      Percona-XtraDB-Cluster-devel-<span class="pl-pse">#{</span><span class="pl-s2">version</span><span class="pl-pse"><span class="pl-s2">}</span></span> Percona-XtraDB-Cluster-client-<span class="pl-pse">#{</span><span class="pl-s2">version</span><span class="pl-pse"><span class="pl-s2">}</span></span></span>
<span class="pl-s1">    <span class="pl-pds">]</span></span>
  <span class="pl-k">else</span>
    default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>client<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>packages<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">%W[</span></span>
<span class="pl-s1">      Percona-Server-devel-<span class="pl-pse">#{</span><span class="pl-s2">version</span><span class="pl-pse"><span class="pl-s2">}</span></span> Percona-Server-client-<span class="pl-pse">#{</span><span class="pl-s2">version</span><span class="pl-pse"><span class="pl-s2">}</span></span></span>
<span class="pl-s1">    <span class="pl-pds">]</span></span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<h3>
<a id="monitoringrb" class="anchor" href="#monitoringrb" aria-hidden="true"><span class="octicon octicon-link"></span></a>monitoring.rb</h3>

<div class="highlight highlight-ruby"><pre>default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>plugins_version<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>1.1.3<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>plugins_packages<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">%w[</span>percona-nagios-plugins percona-zabbix-templates percona-cacti-templates<span class="pl-pds">]</span></span></pre></div>

<h3>
<a id="package_reporb" class="anchor" href="#package_reporb" aria-hidden="true"><span class="octicon octicon-link"></span></a>package_repo.rb</h3>

<div class="highlight highlight-ruby"><pre>default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>yum<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>description<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>Percona Packages<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>yum<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>baseurl<span class="pl-pds">"</span></span>]     <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>http://repo.percona.com/centos/<span class="pl-pse">#{</span><span class="pl-s2">pversion</span><span class="pl-pse"><span class="pl-s2">}</span></span>/os/<span class="pl-pse">#{</span><span class="pl-s2">arch</span><span class="pl-pse"><span class="pl-s2">}</span></span>/<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>yum<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>gpgkey<span class="pl-pds">"</span></span>]      <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>http://www.percona.com/downloads/RPM-GPG-KEY-percona<span class="pl-pds">"</span></span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>yum<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>gpgcheck<span class="pl-pds">"</span></span>]    <span class="pl-k">=</span> <span class="pl-c1">true</span>
default[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>yum<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>sslverify<span class="pl-pds">"</span></span>]   <span class="pl-k">=</span> <span class="pl-c1">true</span></pre></div>

<h2>
<a id="explicit-mycnf-templating" class="anchor" href="#explicit-mycnf-templating" aria-hidden="true"><span class="octicon octicon-link"></span></a>Explicit my.cnf templating</h2>

<p>In some situation it is preferable to explicitly define the attributes needed in a <code>my.cnf</code> file. This is enabled by adding categories to the <code>node[:percona][:conf]</code> attributes. All keys found in the <code>node[:percona][:conf]</code> map will represent categories in the <code>my.cnf</code> file. Each category contains a map of attributes that will be written to the <code>my.cnf</code> file for that category. See the example for more details.</p>

<h3>
<a id="example" class="anchor" href="#example" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example:</h3>

<div class="highlight highlight-ruby"><pre>node[<span class="pl-s1"><span class="pl-pds">"</span>percona<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>conf<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>mysqld<span class="pl-pds">"</span></span>][<span class="pl-s1"><span class="pl-pds">"</span>slow_query_log_file<span class="pl-pds">"</span></span>] <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>/var/lib/mysql/data/mysql-slow.log<span class="pl-pds">"</span></span></pre></div>

<p>This configuration would write the <code>mysqld</code> category to the <code>my.cnf</code> file and have an attribute <code>slow_query_log_file</code> whose value would be <code>/var/lib/mysql/data/mysql-slow.log</code>.</p>

<h3>
<a id="example-output-mycnf" class="anchor" href="#example-output-mycnf" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example output (my.cnf):</h3>

<div class="highlight highlight-ini"><pre><span class="pl-en">[mysqld]</span>
<span class="pl-k">slow_query_log_file</span> = /var/lib/mysql/data/mysql-slow.log</pre></div>

<h2>
<a id="dynamically-setting-the-bind-address" class="anchor" href="#dynamically-setting-the-bind-address" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dynamically setting the bind address</h2>

<p>There's a special attribute <code>node["percona"]["server"]["bind_to"]</code> that allows you to dynamically set the bind address. This attribute accepts the values <code>"public_ip"</code>, <code>"private_ip"</code>, <code>"loopback"</code>, or and interface name like <code>"eth0"</code>. Based on this, the recipe will find a corresponding ipv4 address, and override the <code>node["percona"]["server"]["bind_address"]</code> attribute.</p>

<h2>
<a id="goals" class="anchor" href="#goals" aria-hidden="true"><span class="octicon octicon-link"></span></a>Goals</h2>

<p>In no particular order:</p>

<ul>
<li>Be the most flexible way to setup a MySQL distribution through Chef

<ul>
<li>Support for Chef Solo</li>
<li>Support for Chef Server</li>
</ul>
</li>
<li>Support the following common database infrastructures:

<ul>
<li>Single server instance</li>
<li>Traditional Master/Slave replication</li>
<li>Multi-master cluster replication</li>
</ul>
</li>
<li>Support the most recent Chef runtime environments</li>
<li>Be the easiest way to setup a MySQL distribution through Chef</li>
</ul>

<h2>
<a id="todo" class="anchor" href="#todo" aria-hidden="true"><span class="octicon octicon-link"></span></a>TODO</h2>

<ul>
<li>Fully support all of the standard Chef-supported distributions</li>
</ul>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h2>

<ol>
<li>Fork it</li>
<li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li>
<li>Commit your changes (<code>git commit -am 'Added some feature'</code>)</li>
<li>Push to the branch (<code>git push origin my-new-feature</code>)</li>
<li>Create new Pull Request</li>
</ol>

<h2>
<a id="contributors" class="anchor" href="#contributors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributors</h2>

<p>Many thanks go to the following <a href="https://github.com/phlipper/chef-percona/graphs/contributors">contributors</a> who have helped to make this cookbook even better:</p>

<ul>
<li>
<strong><a href="https://github.com/jagcrete">@jagcrete</a></strong>

<ul>
<li>configurable keyserver</li>
<li>encrypted password data bag</li>
<li>custom <code>my.cnf</code> file</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/pwelch">@pwelch</a></strong>

<ul>
<li>ensure cookbook dependencies are loaded</li>
<li>
<a href="http://acrmp.github.com/foodcritic/">Foodcritic</a> compliance updates</li>
<li>various minor patches and updates</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/masv">@masv</a></strong>

<ul>
<li>compatibility updates for 5.5</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/stottsan">@stottsan</a></strong>

<ul>
<li>config cleanup to prevent service restarts on chef run</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/abecciu">@abecciu</a></strong>

<ul>
<li>auto-generate secure passwords by default</li>
<li>add ability to dynamically set the bind address</li>
<li>add support for <code>main_config_file</code> attribute</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/patcon">@patcon</a></strong>

<ul>
<li>add <code>yum</code> support for <code>centos</code>, <code>amazon</code>, <code>scientific</code>, <code>fedora</code>, and <code>redhat</code> distributions</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/psi">@psi</a></strong>

<ul>
<li>fixes required for RedHat platforms</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/TheSerapher">@TheSerapher</a></strong>

<ul>
<li>improvements for master/slave replication setup</li>
<li>updates and clarifications to the README</li>
<li>add attribute to control server restart on config changes</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/bensomers">@bensomers</a></strong>

<ul>
<li>minor fixes to <code>replication.sql</code>
</li>
<li>fix a very dangerous bug around binlog-do-db setting for slave servers</li>
<li>fix slow query log setting for 5.5</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/tdg5">@tdg5</a></strong>

<ul>
<li>avoid use of <code>set_unless</code> for chef-solo, workaround for CHEF-2945</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/gpendler">@gpendler</a></strong>

<ul>
<li>avoid re-installation of packages RedHat platforms</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/vinu">@vinu</a></strong>

<ul>
<li>pin the percona apt repo with high priority</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/ckuttruff">@ckuttruff</a></strong>

<ul>
<li>improve security on debian-based systems by changing config file permissions</li>
<li>don't pass mysql root password in plaintext commands</li>
<li>fix issue with -p flag when setting initial password</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/srodrig0209">@srodrig0209</a></strong>

<ul>
<li>add the <code>monitoring</code> recipe</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/jesseadams">@jesseadams</a></strong>

<ul>
<li>fixes for custom datadir setting use case</li>
<li>add more Percona XtraDB cluster options</li>
<li>XtraDB cluster support for replication over ssl</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/see0">@see0</a></strong>

<ul>
<li>fix incorrect root password reference</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/baldur">@baldur</a></strong>

<ul>
<li>
<em>(honorable mention)</em> fix incorrect root password reference</li>
<li>fix typo in attribute for server username</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/chrisroberts">@chrisroberts</a></strong>

<ul>
<li>
<em>(honorable mention)</em> fix issue with -p flag when setting initial password</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/aaronjensen">@aaronjensen</a></strong>

<ul>
<li>allow server to not be started on startup</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/pioneerit">@pioneerit</a></strong>

<ul>
<li>add sections to <code>.my.cnf</code> for <code>mysqladmin</code> and <code>mysqldump</code>
</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/AndreyChernyh">@AndreyChernyh</a></strong>

<ul>
<li>use resources helper to support newer chef versions</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/avit">@avit</a></strong>

<ul>
<li>add default utf8 character set option</li>
<li>cleanup replication support</li>
<li>remove dependency on opscode/mysql cookbook</li>
<li>fix permissions for configuration files</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/alexzorin">@alexzorin</a></strong>

<ul>
<li>add support for <code>skip-name-resolve</code> option</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/jyotty">@jyotty</a></strong>

<ul>
<li>specify <code>binlog_format</code> in master and slave roles</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/adamdunkley">@adamdunkley</a></strong>

<ul>
<li>fix <code>table_cache</code> variable for mysql versions 5.6 and above</li>
<li>remove unnecessary rewind, perform it directly</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/freerobby">@freerobby</a></strong>

<ul>
<li>add requirements to <code>Berksfile</code>
</li>
<li>more flexible apt dependency version to minimize conflicts</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/spovich">@spovich</a></strong>

<ul>
<li>disable <code>old_passwords</code> support by default</li>
<li>force version 5.5 on Debian family to maintain consistency with RHEL family</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/v1nc3ntlaw">@v1nc3ntlaw</a></strong>

<ul>
<li>add attribute <code>innodb_file_format</code>
</li>
<li>add attribute <code>ignore_db</code> for slave template</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/joegaudet">@joegaudet</a></strong>

<ul>
<li>add attribute <code>group_concat_max_len</code>
</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/mikesmullin">@mikesmullin</a></strong>

<ul>
<li>accumulating patches from multiple sources</li>
<li>tempdir fixes</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/totally">@totally</a></strong>

<ul>
<li>support <code>yum</code> cookbook v3.0</li>
<li>use attributes for package names</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/sapunoff">@sapunoff</a></strong>

<ul>
<li>initial implementation of using attributes for package names</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/errm">@errm</a></strong>

<ul>
<li>add attribute <code>skip_passwords</code>
</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/ewr">@ewr</a></strong>

<ul>
<li>fix mysql calls when there is no root password</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/jharley">@jharley</a></strong>

<ul>
<li>make <code>connect_timeout</code> configurable</li>
<li>add cluster support for <code>wsrep_sst_auth</code> configuration</li>
<li>update default for <code>wsrep_provider</code> on Debian</li>
<li>enable InnoDB tuning for standalone and cluster</li>
<li>set proper <code>my.cnf</code> location based on platform family</li>
<li>add missing tunables to 'cluster' <code>my.cnf</code> template</li>
<li>fix regression in cluster configuration template</li>
<li>centralize <code>jemalloc</code> configuration for cluster and server configurations</li>
<li>sync cluster configuration file with main configuration</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/achied">@achied</a></strong>

<ul>
<li>fix setting passwords if attribute not defined</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/akshah123">@akshah123</a></strong>

<ul>
<li>force client packages to install version 5.5</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/tkuhlman">@tkuhlman</a></strong>

<ul>
<li>re-add cluster support</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/mancdaz">@mancdaz</a></strong>

<ul>
<li>install monitoring plugins from package instead of tarball</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/iancoffey">@iancoffey</a></strong>

<ul>
<li>set debian-sys-maint password after grant</li>
<li>add attribute <code>skip_configure</code>
</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/notnmeyer">@notnmeyer</a></strong>

<ul>
<li>fix <code>access_grants</code> guards for <code>cluster</code> and <code>backup</code> recipes</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/odacrem">@odacrem</a></strong>

<ul>
<li>use correct replication username in <code>replication.sql</code>
</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/g3kk0">@g3kk0</a></strong>

<ul>
<li>fix missing mysql log directory</li>
<li>add attribute <code>wait_timeout</code>
</li>
<li>data-drive percona yum repository</li>
<li>add support for <code>jemalloc</code>
</li>
<li>fix idempotency with chef-solo and <code>skip_password</code> attribute</li>
<li>add attribute <code>expand_fast_index_creation</code>
</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/gfloyd">@gfloyd</a></strong>

<ul>
<li>honor <code>skip_configure</code> attribute in cluster recipe</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/paustin01">@paustin01</a></strong>

<ul>
<li>add <code>encrypted_data_bag_secret_file</code> attribute</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/ajardan">@ajardan</a></strong>

<ul>
<li>support master-master replication in the <code>replication_master.sql</code> template</li>
<li>extend master-master capabilities and add ssl support</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/realloc">@realloc</a></strong>

<ul>
<li>add <code>mysql2</code> gem provider</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/tbunnyman">@tbunnyman</a></strong>

<ul>
<li>make <code>ignore_db</code> attribute into an array &amp; add matching <code>ignore_table</code> attribute</li>
<li>add <code>suppress_1592</code> replication attribute</li>
<li>add <code>sql_modes</code> attribute</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/mzdrale">@mzdrale</a></strong>

<ul>
<li>fix cluster package name on RHEL systems</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/Sauraus">@Sauraus</a></strong>

<ul>
<li>fix cluster dependency package installation on RHEL systems</li>
<li>fix <code>slow_query_logdir</code> path creation</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/jim80net">@jim80net</a></strong>

<ul>
<li>fix toolkit installation for version 5.6 on RHEL systems</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/helgi">@helgi</a></strong>

<ul>
<li>use <code>mysql</code> command vs. a file to check the root password</li>
<li>generate configuration file before setting up data directory</li>
<li>ensure <code>includedir</code> is created if provided</li>
<li>add attribute <code>performance_schema</code>
</li>
<li>fix mysql root password update check</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/arnesund">@arnesund</a></strong>

<ul>
<li>fix package list for clusters based on CentOS</li>
<li>avoid uninstall of <code>mysql-libs</code> when not needed</li>
<li>fix XtraDB Cluster 5.6 installation on CentOS 7</li>
<li>add support for <code>chef-vault</code>
</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/n3bulous">@n3bulous</a></strong>

<ul>
<li>add <code>federated</code> and <code>read_rnd_buffer_size</code> attributes</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/runwaldarshu">@runwaldarshu</a></strong>

<ul>
<li>add <code>sensitive</code> attribute for resources</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/vermut">@vermut</a></strong>

<ul>
<li>fix <code>ConfigHelper</code> definitions to make them available from <code>module_function</code>
</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/dng-dev">@dng-dev</a></strong>

<ul>
<li>add <code>innodb_import_table_from_xtrabackup</code> attribute</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/washingtoneg">@washingtoneg</a></strong>

<ul>
<li>add <code>myisam_read_buffer_size</code> attribute</li>
</ul>
</li>
<li>
<strong><a href="https://github.com/cmjosh">@cmjosh</a></strong>

<ul>
<li>fix version-dependent package attribute issues</li>
</ul>
</li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p><strong>chef-percona</strong></p>

<ul>
<li>Freely distributable and licensed under the <a href="http://phlipper.mit-license.org/2012-2015/license.html">MIT license</a>.</li>
<li>Copyright (c) 2012-2015 Phil Cohen (<a href="mailto:github@phlippers.net">github@phlippers.net</a>)</li>
<li><a href="http://phlippers.net/">http://phlippers.net/</a></li>
</ul>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/phlipper">phlipper</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-10172882-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>